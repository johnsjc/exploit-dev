## 6. Cusco

**Objective**: Buffer Overflow (Controlling IP)

This is a simple buffer overflow vulnerability. If we look at the **main** function, we see that getsn is again accepting more bytes than the program is telling us.

```
4514:  3e40 3000      mov	#0x30, r14
4518:  0f41           mov	sp, r15
451a:  b012 9645      call	#0x4596 <getsn>
```

Passwords are  only supposed to be a maximum of 16 characters, but we are allowed to write a whopping 0x30 (48) bytes to the buffer! Let's use a pattern string that is 48 bytes long (Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5) and set a breakpoint at the end of main to see the state of the registers.

If we inspect sp (the stack pointer) after main runs, we see part of our input. That means we can control program execution!

```
43fe:   6135 4161 3641 6137  a5Aa6Aa7
```

6135 4161 occurs at offset 17 in our pattern string. We just need to write an address that we would like to jump to after main returns. How about the **unlock_door** function?

```
4528:  b012 4644      call	#0x4446 <unlock_door>
```

**Flag**: 41414141414141414141414141414141**4644**
